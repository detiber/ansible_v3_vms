#! ansible-playbook -K
---
- name: Bootstrap the base image
  hosts: localhost
  connection: local
  tags: prep
  become: yes
  vars:
    base_host_name: rhel7-base

  tasks:
  - name: Ensure libvirt packages are installed
    package:
      name: "{{ item }}"
      state: present
    with_items:
    - libvirt
    - libvirt-daemon-kvm
    - libvirt-python

  - name: Ensure libvirt daemon is started
    systemd:
      name: libvirtd
      state: started
      enabled: yes

  - name: Get list of VMs
    virt:
      command: list_vms
      uri: "{{ qemu_uri }}"
    register: vm_list

  - debug: var=vm_list
